<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Свинка и TON</title>
  <style>
    /************************************************
     * Общие настройки страницы
     ************************************************/
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden; /* Запрещаем прокрутку */
      background: #ccc; /* Серый фон подложки */
      font-family: Arial, sans-serif;
    }

    /************************************************
     * 1. Экран Loading (серый, 2 секунды)
     ************************************************/
    .loading-screen {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: #ccc; /* Серый цвет */
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .loading-text {
      font-size: 2rem;
      color: #333;
      animation: bounce 1.5s infinite;
    }
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-20px); }
      60% { transform: translateY(-10px); }
    }
    .hidden {
      display: none;
    }

    /************************************************
     * 2. Верхняя панель (Баланс TON, кнопка Депозит)
     ************************************************/
    .top-bar {
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 50px;
      background: #333;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between; /* Кнопка слева, баланс справа */
      padding: 0 20px;
      box-sizing: border-box;
      z-index: 100;
    }
    .balance-container {
      display: flex;
      align-items: center;
    }
    .ton-icon {
      width: 20px; 
      height: 20px;
      margin: 0 6px;
      vertical-align: middle;
    }
    .balance-text {
      font-size: 1rem;
    }
    .deposit-btn {
      padding: 8px 16px;
      background: #fff;
      color: #333;
      border: 2px solid #888;
      cursor: pointer;
      transition: background 0.2s;
    }
    .deposit-btn:hover {
      background: #ffd;
    }

    /************************************************
     * 3. Пол (floor.png)
     ************************************************/
    .floor {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 200px; /* Высота пола */
      background: url("images1/floor.png") center/cover no-repeat;
      z-index: 1;
    }

    /************************************************
     * 4. Миска (miska.png)
     ************************************************/
    .bowl {
      position: absolute;
      bottom: 200px; /* сразу над полом */
      left: 50px;    /* смещаем немного слева */
      width: 100px;
      height: auto;
      z-index: 2;
    }

    /************************************************
     * 5. Игровая зона: свинка ходит
     ************************************************/
    .game-area {
      position: absolute;
      top: 50px; /* под верхней панелью */
      left: 0;
      width: 100%;
      height: calc(100% - 50px - 200px); 
      /* вычитаем: 50px (top-bar) + 200px (floor) */
      z-index: 3;
      overflow: hidden; /* не даём свинке выйти за пределы */
      /* фон прозрачный (над серой подложкой) */
    }

    /* Свинка pig223.png с анимацией шага (2 кадра) */
    .pig {
      position: absolute;
      width: 120px; 
      height: 80px;
      background: url("images1/pig223.png") 0 0 no-repeat;
      background-size: cover; 
      /* Если pig223.png содержит, к примеру, 240px шириной × 80px высотой
         (2 кадрова анимация: кадр 0..119px, кадр 120..239px), 
         тогда .pig = 120×80, и мы сдвигаем фоновую позицию 
         при анимации 'walk'.
      */
      transform: translate(-50%, -50%);
      transition: top 2s linear, left 2s linear; /* плавное перемещение */
      animation: walk 0.5s steps(2) infinite;    /* анимация лап (2 кадра) */
    }
    @keyframes walk {
      0%   { background-position-x: 0; }
      100% { background-position-x: -120px; }
    }

  </style>
</head>
<body>

  <!-- (1) Экран загрузки (серый) -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-text">Loading...</div>
  </div>

  <!-- (2) Верхняя панель: Баланс, кнопка Депозит -->
  <div class="top-bar">
    <!-- Кнопка "Депозит" слева -->
    <button class="deposit-btn" id="depositBtn">Депозит</button>

    <!-- Справа баланс TON (изначально 0) -->
    <div class="balance-container">
      <span class="balance-text">Баланс:</span>
      <img src="images1/ton.png" alt="TON" class="ton-icon" />
      <span id="tonBalanceSpan" class="balance-text">0</span>
    </div>
  </div>

  <!-- (3) Игровая зона (свинка ходит) -->
  <div class="game-area" id="gameArea">
    <div class="pig" id="pig"></div>
  </div>

  <!-- (4) Миска -->
  <img src="images1/miska.png" alt="Миска" class="bowl" id="bowl" />

  <!-- (5) Пол (floor.png) -->
  <div class="floor"></div>

  <script>
    /************************************************
     * 1. Скрываем экран "Loading..." через 2 сек
     ************************************************/
    setTimeout(() => {
      document.getElementById('loadingScreen').classList.add('hidden');
    }, 2000);

    /************************************************
     * 2. Баланс TON и логика депозита
     ************************************************/
    let tonBalance = 0;
    let userWallet = null; // Храним TON-кошелёк, если введён
    const tonBalanceSpan = document.getElementById('tonBalanceSpan');
    const depositBtn = document.getElementById('depositBtn');

    // Проверяем, нет ли кошелька в localStorage
    if (localStorage.getItem('userWallet')) {
      userWallet = localStorage.getItem('userWallet');
    }

    function updateBalance() {
      tonBalanceSpan.textContent = tonBalance.toFixed(2);
    }
    updateBalance();

    depositBtn.addEventListener('click', () => {
      // Если кошелёк ещё не введён, спрашиваем один раз
      if (!userWallet) {
        const w = prompt('Введите свой TON-кошелёк:');
        if (!w) {
          alert('Вы не ввели кошелёк');
          return;
        }
        userWallet = w;
        localStorage.setItem('userWallet', w);
        alert(`Ваш кошелёк сохранён: ${userWallet}`);
      }

      // Далее спрашиваем сумму (максимум 0.5)
      const amountStr = prompt('Введите сумму депозита (макс 0.5 TON):', '0.5');
      if (!amountStr) return; // Отмена
      const depositAmount = parseFloat(amountStr);
      if (isNaN(depositAmount) || depositAmount <= 0) {
        alert('Некорректная сумма депозита');
        return;
      }
      if (depositAmount > 0.5) {
        alert('Максимум 0.5 TON');
        return;
      }

      // Имитируем подтверждение оплаты
      const confirmed = confirm(`Оплатить ${depositAmount} TON? (имитация)`);
      if (confirmed) {
        tonBalance += depositAmount;
        updateBalance();
        alert(`Оплата прошла успешно. Баланс: ${tonBalance.toFixed(2)} TON`);
      }
    });

    /************************************************
     * 3. Логика движения свинки (плавно, каждые 3 сек)
     ************************************************/
    const pig = document.getElementById('pig');
    const gameArea = document.getElementById('gameArea');
    const bowl = document.getElementById('bowl');

    // Размер самой свинки (как в CSS)
    const pigWidth = 120;
    const pigHeight = 80;

    // Каждые 3 секунды — новое движение
    setInterval(movePigRandomly, 3000);

    function movePigRandomly() {
      // Размеры области
      const areaWidth = gameArea.clientWidth;
      const areaHeight = gameArea.clientHeight;

      const minX = pigWidth / 2;
      const maxX = areaWidth - pigWidth / 2;
      const minY = pigHeight / 2;
      const maxY = areaHeight - pigHeight / 2;

      // Случайные координаты (центр свинки)
      const newX = Math.floor(Math.random() * (maxX - minX + 1)) + minX;
      const newY = Math.floor(Math.random() * (maxY - minY + 1)) + minY;

      // Проверка, не пересекается ли с миской
      const bowlRect = bowl.getBoundingClientRect();
      const bowlX = bowlRect.left + bowlRect.width / 2;
      const bowlY = bowlRect.top + bowlRect.height / 2;
      const bowlRadius = Math.max(bowlRect.width, bowlRect.height) / 2;

      const gameRect = gameArea.getBoundingClientRect();
      const pigGlobalX = gameRect.left + newX;
      const pigGlobalY = gameRect.top + newY;

      const dx = pigGlobalX - bowlX;
      const dy = pigGlobalY - bowlY;
      const dist = Math.sqrt(dx * dx + dy * dy);

      const pigRadius = pigWidth / 2;

      if (dist < (bowlRadius + pigRadius)) {
        // Если слишком близко к миске — не двигаемся
        return;
      }

      // Иначе двигаем свинку
      pig.style.left = newX + 'px';
      pig.style.top = newY + 'px';
    }
  </script>
</body>
</html>
